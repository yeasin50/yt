<div class="course-sidebar">
  <div class="sidebar-header">
    <h3>Course Menu</h3>
    <button class="close-btn" onclick="closeSidebar()">✕</button>
  </div>

  <ul class="sidebar-list">
    {{ $current := . }}
    {{ $root := .CurrentSection.Parent | default .CurrentSection }}

    {{/* Sort folders (sections) by filesystem order */}}
    {{ $sections := sort $root.Sections ".File.Dir" "asc" }}

    {{ range $sections }}
      {{ $isActive := in $current.RelPermalink .RelPermalink }}
      <li class="sidebar-folder">
        <button class="folder-toggle" data-title="{{ .Title }}" onclick="toggleFolder(this)">
          {{ if $isActive }}▼{{ else }}▶{{ end }} {{ .Title }}
        </button>

        <ul class="sidebar-sublist" style="display:{{ if $isActive }}block{{ else }}none{{ end }};">
          {{/* Sort pages inside the section */}}
          {{ $pages := sort .Pages ".File.Dir" "asc" }}
          {{ range $i, $pages := $pages }}
            <li>
              <a href="{{ .RelPermalink }}" {{ if eq .Permalink $current.Permalink }}class="active"{{ end }}>
                  {{ add $i 1 }} . {{ .Title }}
              </a>
            </li>
          {{ end }}
        </ul>
      </li>
    {{ end }}
  </ul>
</div>

<script>
function toggleFolder(btn) {
  const sublist = btn.nextElementSibling;
  if (!sublist) return;
  const isVisible = sublist.style.display !== "none";
  const title = btn.dataset.title;
  btn.textContent = (isVisible ? "▶ " : "▼ ") + title;
  sublist.style.display = isVisible ? "none" : "block";
}

// Initialize all folders collapsed
document.addEventListener("DOMContentLoaded", () => {
  document.querySelectorAll(".folder-toggle").forEach(btn => {
    const title = btn.dataset.title;
    btn.textContent = "▶ " + title;
  });
});
</script>
